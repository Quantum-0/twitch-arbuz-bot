<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Pair Memory Heat Game</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: transparent;
      width: 100%;
      height: 100%;
      overflow: hidden;
      font-family: system-ui, sans-serif;
    }

    .wrapper {
      position: absolute;
      top: var(--offset-top);
      left: var(--offset-left);
      right: var(--offset-right);
      bottom: var(--offset-bottom);
    }

    .game {
      display: grid;
      width: 100%;
      height: 100%;
    }

    .card {
      width: var(--card-size);
      height: var(--card-size);

      position: relative;
      transform-style: preserve-3d;
      transition: transform 0.6s ease, box-shadow .4s ease;
      cursor: pointer;
    }

    .card.flipped { transform: rotateY(180deg); }
    .card.matched { pointer-events: none; }

    .face {
      position: absolute;
      inset: 0;
      border-radius: 22px;
      backface-visibility: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .front {
      background: linear-gradient(135deg,#ff8a00,#e52e71);
    }

    .back {
      transform: rotateY(180deg);
      background: linear-gradient(135deg,#4facfe,#00f2fe);
      flex-direction: column;
      padding: 14%;
    }

    .back img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      border-radius: 50%;
    }

    .caption {
      font-size: 18px;
      margin-top: 8px;
    }
  </style>
</head>
<body>

<div class="wrapper">
  <div class="game" id="game"></div>
</div>

<script>
  const CHANNEL_ID = {{ channel_id }};
  const OFFSET_LEFT = {{ offset.left }};   // 0..1
  const OFFSET_TOP = {{ offset.top }};
  const OFFSET_RIGHT = {{ offset.right }};
  const OFFSET_BOTTOM = {{ offset.bottom }};
  const PAIRS = {{ cards | tojson | safe }};

  const CARD_SCALE = {{ card_scale | default(1) }};
</script>

<script>
  function updateLayout() {
    const cols = 5;
    const rows = 4;

    // ðŸ‘‰ Ð¿ÐµÑ€ÐµÐ²Ð¾Ð´ Ð¿Ñ€Ð¾Ñ†ÐµÐ½Ñ‚Ð¾Ð² Ð² Ð¿Ð¸ÐºÑÐµÐ»Ð¸
    const offsetLeftPx = window.innerWidth * OFFSET_LEFT;
    const offsetRightPx = window.innerWidth * OFFSET_RIGHT;
    const offsetTopPx = window.innerHeight * OFFSET_TOP;
    const offsetBottomPx = window.innerHeight * OFFSET_BOTTOM;

    // Ð·Ð°Ñ‰Ð¸Ñ‚Ð° Ð¾Ñ‚ Ð½ÐµÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ñ‹Ñ… Ð·Ð½Ð°Ñ‡ÐµÐ½Ð¸Ð¹
    const width = Math.max(0, window.innerWidth - offsetLeftPx - offsetRightPx);
    const height = Math.max(0, window.innerHeight - offsetTopPx - offsetBottomPx);

    // Ð¼Ð°ÐºÑÐ¸Ð¼Ð°Ð»ÑŒÐ½Ñ‹Ð¹ ÐºÐ²Ð°Ð´Ñ€Ð°Ñ‚
    const baseSize = Math.min(
      width / cols,
      height / rows
    );

    const cardSize = baseSize * CARD_SCALE;

    // gap Ð¾Ñ‚Ð´ÐµÐ»ÑŒÐ½Ð¾ Ð¿Ð¾ Ð¾ÑÑÐ¼
    const gapX = cols > 1
      ? (width - cardSize * cols) / (cols - 1)
      : 0;

    const gapY = rows > 1
      ? (height - cardSize * rows) / (rows - 1)
      : 0;

    const game = document.getElementById('game');

    game.style.gridTemplateColumns = `repeat(${cols}, ${cardSize}px)`;
    game.style.gridTemplateRows = `repeat(${rows}, ${cardSize}px)`;

    game.style.columnGap = `${Math.max(0, gapX)}px`;
    game.style.rowGap = `${Math.max(0, gapY)}px`;

    // Ð¿Ñ€Ð¾ÐºÐ¸Ð´Ñ‹Ð²Ð°ÐµÐ¼ Ð² CSS
    document.documentElement.style.setProperty('--card-size', cardSize + 'px');

    document.documentElement.style.setProperty('--offset-left', offsetLeftPx + 'px');
    document.documentElement.style.setProperty('--offset-top', offsetTopPx + 'px');
    document.documentElement.style.setProperty('--offset-right', offsetRightPx + 'px');
    document.documentElement.style.setProperty('--offset-bottom', offsetBottomPx + 'px');
  }

  window.addEventListener('resize', updateLayout);
  window.addEventListener('load', updateLayout);
</script>

<script src="/static/js/heat-ws.js"></script>
<script src="/static/js/pair.js"></script>

</body>
</html>