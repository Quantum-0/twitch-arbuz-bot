{% extends "base.html" %}

{% block title %}Настройки — Quantum0's Bot{% endblock %}

{% block styles %}{{ super() }}

{% block head_scripts %}
<script src="/static/js/panel-scripts.js"></script>
{% endblock %}

/* TODO: Refactor!!! */
.memealert-coins-wrapper {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: 10px;
}
.memealert-coins {
    display: flex;
    align-items: center;
    gap: 10px;
}
.memealert-coins .coin-btn {
    background-color: #4CAF50;
    color: #fff;
    border: none;
    border-radius: 5px;
    font-size: 20px;
    line-height: 1;
    padding: 6px 14px;
    margin: 0;
    cursor: pointer;
    transition: background-color 0.2s;
}
.memealert-coins .coin-btn:hover { background-color: #45a049; }
.memealert-coins input {
    width: 80px;
    text-align: center;
    padding: 8px;
    border: 2px solid #4CAF50;
    border-radius: 5px;
    background-color: #fff;
    font-size: 16px;
    margin: 0;
}

.overlay-section {
    margin-left: 20px;
    margin-top: 10px;
}

.overlay-title {
    margin-bottom: 6px;
}

.overlay-copy-input {
    width: 100%;
    padding: 8px 10px;
    border: 2px solid #4CAF50;
    border-radius: 5px;
    font-size: 14px;
    background-color: #f9fff9;
    cursor: pointer;
}

.overlay-copy-hint {
    display: block;
    margin-top: 4px;
    color: #666;
    font-size: 12px;
}
{% endblock %}

{% block content %}
<h2>Привет, {{ user.login_name }}!</h2>
<p>Настройте функции вашего бота:</p>

<hr>

<section>
    <h3>Настройки чат-бота</h3>

    <!-- Главный переключатель -->
    <div class="toggle-label">
        <span><b>Включить чат-бота</b></span>
        <div class="toggle-switch {% if settings.enable_chat_bot %}active{% endif %}" data-name="enable_chat_bot"></div>
    </div>

    <hr>

    <!-- Остальные переключатели -->
    <div id="dependent-toggles" class="toggles-grid">
        <div class="toggle-label {% if not settings.enable_chat_bot %}disabled{% endif %}">
            <span>Включить !кусь</span>
            <div class="toggle-switch {% if settings.enable_bite %}active{% endif %}" data-name="enable_bite"></div>
        </div>
        <div class="toggle-label {% if not settings.enable_chat_bot %}disabled{% endif %}">
            <span>Включить !лизь</span>
            <div class="toggle-switch {% if settings.enable_lick %}active{% endif %}" data-name="enable_lick"></div>
        </div>
        <div class="toggle-label {% if not settings.enable_chat_bot %}disabled{% endif %}">
            <span>Включить !boop</span>
            <div class="toggle-switch {% if settings.enable_boop %}active{% endif %}" data-name="enable_boop"></div>
        </div>
        <div class="toggle-label {% if not settings.enable_chat_bot %}disabled{% endif %}">
            <span>Включить !pat</span>
            <div class="toggle-switch {% if settings.enable_pat %}active{% endif %}" data-name="enable_pat"></div>
        </div>
        <div class="toggle-label {% if not settings.enable_chat_bot %}disabled{% endif %}">
            <span>Включить !hug</span>
            <div class="toggle-switch {% if settings.enable_hug %}active{% endif %}" data-name="enable_hug"></div>
        </div>
        <div class="toggle-label {% if not settings.enable_chat_bot %}disabled{% endif %}">
            <span>Включить !банан</span>
            <div class="toggle-switch {% if settings.enable_banana %}active{% endif %}" data-name="enable_banana"></div>
        </div>
        <div class="toggle-label {% if not settings.enable_chat_bot %}disabled{% endif %}">
            <span>Включить !lurk</span>
            <div class="toggle-switch {% if settings.enable_lurk %}active{% endif %}" data-name="enable_lurk"></div>
        </div>
        <div class="toggle-label {% if not settings.enable_chat_bot %}disabled{% endif %}">
            <span>Включить !хорни</span>
            <div class="toggle-switch {% if settings.enable_horny_good %}active{% endif %}" data-name="enable_horny_good"></div>
        </div>
        <div class="toggle-label {% if not settings.enable_chat_bot %}disabled{% endif %}">
            <span>Включить !хвост</span>
            <div class="toggle-switch {% if settings.enable_tail %}active{% endif %}" data-name="enable_tail"></div>
        </div>
        <div class="toggle-label {% if not settings.enable_chat_bot %}disabled{% endif %}">
            <span>Включить !dice</span>
            <div class="toggle-switch {% if settings.enable_dice %}active{% endif %}" data-name="enable_dice"></div>
        </div>
        <div class="toggle-label {% if not settings.enable_chat_bot %}disabled{% endif %}">
            <span>Включить !bonk</span>
            <div class="toggle-switch {% if settings.enable_bonk %}active{% endif %}" data-name="enable_bonk"></div>
        </div>
        <div class="toggle-label {% if not settings.enable_chat_bot %}disabled{% endif %}">
            <span>Включить !трусы</span>
            <div class="toggle-switch {% if settings.enable_pants %}active{% endif %}" data-name="enable_pants"></div>
        </div>
        <div class="toggle-label {% if not settings.enable_chat_bot %}disabled{% endif %}">
            <span>Включить !якто</span>
            <div class="toggle-switch {% if settings.enable_whoami %}active{% endif %}" data-name="enable_whoami"></div>
        </div>
        <div class="toggle-label {% if not settings.enable_chat_bot %}disabled{% endif %}">
            <span>Включить !вкусняшка</span>
            <div class="toggle-switch {% if settings.enable_treat %}active{% endif %}" data-name="enable_treat"></div>
        </div>
        <div class="toggle-label {% if not settings.enable_chat_bot %}disabled{% endif %}">
            <span>Включить !покормить</span>
            <div class="toggle-switch {% if settings.enable_feed %}active{% endif %}" data-name="enable_feed"></div>
        </div>
        <div class="toggle-label {% if not settings.enable_chat_bot %}disabled{% endif %}">
            <span>Включить !паста</span>
            <div class="toggle-switch {% if settings.enable_pasta %}active{% endif %}" data-name="enable_pasta"></div>
        </div>
        <!--
        <div class="toggle-label {% if not settings.enable_chat_bot %}disabled{% endif %}">
            <span>Включить !бунд</span>
            <div class="toggle-switch {% if settings.enable_riot %}active{% endif %}" data-name="enable_riot"></div>
        </div>
        -->
        <!--
        <div class="toggle-label {% if not settings.enable_chat_bot %}disabled{% endif %}">
            <span>Включить обработчик пирамидок (пока работает криво о.О)</span>
            <div class="toggle-switch {% if settings.enable_pyramid %}active{% endif %}" data-name="enable_pyramid"></div>
        </div>
        -->
        <!--
        <div class="toggle-label {% if not settings.enable_chat_bot %}disabled{% endif %}">
            <span>Включить ломатель пирамидок</span>
            <div class="toggle-switch {% if settings.enable_pyramid_breaker %}active{% endif %}" data-name="enable_pyramid_breaker"></div>
        </div>
        -->
    </div>
</section>

<hr>

<section>
    <h3>Настройки мемалёртов</h3>
    {% if memealerts.enabled %}
        <button id="memealerts-btn" class="btn-danger" onclick="toggleMemealerts(false)">Отключить мемалёрты</button>
        <p>Время жизни токена:
            {% if memealerts.expires_in == 0 %}
                <span style="font-weight: bold; color: red;">{{ memealerts.expires_in }} дней</span>
            {% else %}
                {{ memealerts.expires_in }} дней
            {% endif %}. По истечению срока действия токена его необходимо будет обновить.
        </p>
        <button id="refresh-token-btn" onclick="openRefreshModal()">Обновить токен</button>
        <div class="memealert-coins-wrapper">
            <span>Количество мемкоинов за награду</span>
            <div class="memealert-coins">
                <!-- TODO: REFACTOR -->
                <button type="button" class="coin-btn" onclick="changeCoinCount(-1)">−</button>
                <input type="number" id="coin-count" min="1" max="100" value="{{ memealerts.coins_for_reward }}">
                <button type="button" class="coin-btn" onclick="changeCoinCount(1)">+</button>
            </div>
        </div>
    {% else %}
        <button id="memealerts-btn" onclick="openActivateModal()">Включить мемалёрты</button>
    {% endif %}
</section>

<hr>

<section>
    <h3>Другие настройки</h3>
    <div class="toggles-grid">
        <div class="toggle-label">
            <span>Включить shoutout на рейды</span>
            <div class="toggle-switch {% if settings.enable_shoutout_on_raid %}active{% endif %}" data-name="enable_shoutout_on_raid"></div>
        </div>
    </div>
</section>

<hr>

<section>
    <h3>Оверлеи</h3>
    <small class="overlay-copy-hint">
    <p>Интерактивные оверлеи для стрима, обрабатывающие взаимодействия зрителей как из чата, так и клики мышкой по самому стриму, с помощью плагина <a href="https://dashboard.twitch.tv/extensions/cr20njfkgll4okyrhag7xxph270sqk-2.1.1">Heat</a>.</p>
    <p>Для использования - обязательно установите и активируйте <a href="https://dashboard.twitch.tv/extensions/cr20njfkgll4okyrhag7xxph270sqk-2.1.1">Heat</a>.</p>
    <p>После его активации - вы и ваши зрители увидите красную точку при наведении мыши на стрим. После этого можно добавлять любые из перечисленных ниже оверлеев.</p>
    <p>При добавлении оверлея нужно добавить браузерный источник в OBS, указать ссылку, выставить разрешение равное вашему разрешению трансляции и установить положение оверлея полностью под размер сцены, иначе клики будут обрабатываться некорректно.</p>
    </small>
    <div class="overlay-section">
        <p class="overlay-title">
            <a href="https://dashboard.twitch.tv/extensions/cr20njfkgll4okyrhag7xxph270sqk-2.1.1">Heat</a> оверлей с игрой угадай пару
        </p>
        <input
            class="overlay-copy-input"
            type="text"
            value="{{ request.base_url }}overlay/pair?channel_id={{ user.twitch_id }}"
            readonly
            onclick="this.select(); navigator.clipboard.writeText(this.value); showNotification('Скопировано', 'Ссылка для OBS скопирована');"
        >
        <small class="overlay-copy-hint">
            Нажмите, чтобы скопировать ссылку. Для использования требуется подключить <a href="https://dashboard.twitch.tv/extensions/cr20njfkgll4okyrhag7xxph270sqk-2.1.1">Heat</a>.
        </small>
    </div>
    <div class="overlay-section">
        <p class="overlay-title">
            <a href="https://dashboard.twitch.tv/extensions/cr20njfkgll4okyrhag7xxph270sqk-2.1.1">Интерактивный</a> оверлей с висящей звёздочкой
        </p>
        <input
            class="overlay-copy-input"
            type="text"
            value="{{ request.base_url }}overlay/star?channel_id={{ user.twitch_id }}"
            readonly
            onclick="this.select(); navigator.clipboard.writeText(this.value); showNotification('Скопировано', 'Ссылка для OBS скопирована');"
        >
        <small class="overlay-copy-hint">
            Нажмите, чтобы скопировать ссылку. Для использования требуется подключить <a href="https://dashboard.twitch.tv/extensions/cr20njfkgll4okyrhag7xxph270sqk-2.1.1">Heat</a>.
        </small>
        <!--
        <div class="overlay-control">
            <label>
                Позиция (pos):
                <span id="pos-value">—</span>
            </label>
            <input
                type="range"
                min="0"
                max="1"
                step="0.01"
                value=""
                oninput="updatePos(this.value)"
            >
        </div>
        <div class="overlay-control">
            <label>Размер звезды (size):</label>
            <div class="memealert-coins">
                <button type="button" class="coin-btn" onclick="changeStarSize(-1)">−</button>
                <input type="number" id="star-size" min="1" max="100" value="20" oninput="updateUrl()">
                <button type="button" class="coin-btn" onclick="changeStarSize(1)">+</button>
            </div>
        </div>
        -->
    </div>
    {% if user and user.login_name in ["quantum075", "d_e_l_y", "silverosemary"] %}
    <div class="overlay-section">
        <p class="overlay-title">
            Моя тестовая штука, НЕ ТРОГАЙТЕ
        </p>
        <input
            class="overlay-copy-input"
            type="text"
            value="{{ request.base_url }}overlay/ai-sticker?channel_id={{ user.twitch_id }}"
            readonly
            onclick="this.select(); navigator.clipboard.writeText(this.value); showNotification('Скопировано', 'Ссылка для OBS скопирована');"
        >
        <small class="overlay-copy-hint">
            Нажмите, чтобы скопировать ссылку.
        </small>
        <button id="setup-ai-sticker-btn" onclick="setupAiStickerReward()">Установить</button>
    </div>
    {% endif %}
</section>

<div class="notification-container"></div>

<div class="modal" id="memealert-modal">
    <div class="modal-content">
        <h3>Введите ключ</h3>
        <input type="text" id="memealert-key" placeholder="Ваш ключ">
        <a class="tutorial-link" href="/memealerts-tutorial" target="_blank">Как его получить?</a>
        <p>Для того, чтобы обновилось время жизни токена - нужно переавторизоваться на самом Memealerts.</p>
        <div class="modal-buttons">
            <button type="button" class="btn-cancel" onclick="closeModal()">Отмена</button>
            <button type="button" id="save-btn" onclick="saveMemealert()">Сохранить</button>
        </div>
    </div>
</div>
{% endblock %}
