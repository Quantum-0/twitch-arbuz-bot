import random
from time import time

from database.models import TwitchUserSettings, User
from twitch.chat.base.cooldown_command import SimpleCDCommand


class LurkCommand(SimpleCDCommand):
    async def _cooldown_reply(self, user: str, delay: int) -> str | None:
        return None

    cooldown_timer_per_user = 30
    cooldown_timer_per_chat = None

    command_name = "lurk"
    command_aliases = ["lurk", "unlurk", "–ª—É—Ä–∫", "–∞–Ω–ª—É—Ä–∫"]
    command_description = (
        "–°–æ–æ–±—â–∏—Ç—å —Å—Ç—Ä–∏–º–µ—Ä—É –∏ —á–∞—Ç–∏–∫—É, —á—Ç–æ –≤—ã —É—Ö–æ–¥–∏—Ç–µ –≤ –ª—É—Ä–∫ –∏–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç–µ—Å—å –∏–∑ –Ω–µ–≥–æ"
    )

    def is_enabled(self, streamer_settings: TwitchUserSettings) -> bool:
        return streamer_settings.enable_lurk

    async def _handle(self, streamer: User, user: str, message: str) -> str:
        state: bool = not ("unlurk" in message or "–∞–Ω–ª—É—Ä–∫" in message)
        previous_state: bool = (
            await self._state_manager.get_state(
                channel=streamer.login_name,
                user=user.lower(),
                command=self.command_name,
            )
            is not None
        )

        if state == previous_state and state is True:
            return f"@{user}, —Ç—ã –∏ —Ç–∞–∫ —É–∂–µ –≤ –ª—É—Ä–∫–µ"

        if state and not previous_state:
            await self._state_manager.set_state(
                channel=streamer.login_name,
                user=user.lower(),
                command=self.command_name,
                value=time(),
            )
            variants = [
                f"@{user} –ø—Ä—è—á–µ—Ç—Å—è –∑–∞ —Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫ –∏ –Ω–∞–±–ª—é–¥–∞–µ—Ç –∑–∞ —Å—Ç—Ä–∏–º–æ–º –æ—Ç—Ç—É–¥–∞. –°–ø–∞—Å–∏–±–æ –∑–∞ –ª—É—Ä–∫!",
                f"@{user} —Å–ø–æ—Ç—ã–∫–∞–µ—Ç—Å—è –æ–± –∫–∞–º—É—à–µ–∫, –ø–∞–¥–∞–µ—Ç –∏ –ø—Ä–æ–≤–∞–ª–∏–≤–∞–µ—Ç—Å—è –≤ –ª—É—Ä–∫",
                f"–£ @{user} –ø–æ—è–≤–∏–ª–∏—Å—å –±–æ–ª–µ–µ –≤–∞–∂–Ω—ã–µ –¥–µ–ª–∞, —á–µ–º –ø—Ä–æ—Å–º–æ—Ç—Ä —ç—Ç–æ–≥–æ —Å—Ç—Ä–∏–º–∞, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç–µ?!",
                f"@{user} –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –∫—Ä–æ–∫–æ–¥–∏–ª–∞, –ø–æ–≥—Ä—É–∂–∞–µ—Ç—Å—è –≤ –±–ª–∏–∂–∞–π—à—É—é –ª—É–∂—É, –∏ —Ç–µ–ø–µ—Ä—å –æ—Ç—Ç—É–¥–∞ —Ç–æ—Ä—á–∞—Ç —Ç–æ–ª—å–∫–æ –≥–ª–∞–∑–∫–∏ üëÄ",

                f"@{user} –º–µ–¥–ª–µ–Ω–Ω–æ —Ä–∞—Å—Ç–≤–æ—Ä—è–µ—Ç—Å—è –≤ –≤–æ–∑–¥—É—Ö–µ, –æ—Å—Ç–∞–≤–ª—è—è –ø–æ—Å–ª–µ —Å–µ–±—è —Ç–æ–ª—å–∫–æ —à–æ—Ä–æ—Ö‚Ä¶ *–ª—É—Ä–∫ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω*.",
                f"@{user} –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –º–∞–ª–µ–Ω—å–∫–æ–µ –æ–±–ª–∞—á–∫–æ —Ç—É–º–∞–Ω–∞ –∏ —É—Å–∫–æ–ª—å–∑–∞–µ—Ç –≤ —Ä–µ–∂–∏–º –ª—É—Ä–∫–∞.",
                f"@{user} –Ω–∞ —Ü—ã–ø–æ—á–∫–∞—Ö —É–¥–∞–ª—è–µ—Ç—Å—è –≤ —É–≥–æ–ª –∏ –≤–∫–ª—é—á–∞–µ—Ç —Ä–µ–∂–∏–º —Å–∫—Ä—ã—Ç–æ–≥–æ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è.",
                f"@{user} –Ω–∞–¥–µ–≤–∞–µ—Ç —à–ª—è–ø—É-–Ω–µ–≤–∏–¥–∏–º–∫—É –∏ —Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è –≤ —Ç–µ–Ω–∏. –õ—É—Ä–∫!",
                f"@{user} –∑–∞–Ω—ã—Ä–∏–≤–∞–µ—Ç –ø–æ–¥ –æ–¥–µ—è–ª–æ, –≤—ã–≥–ª—è–¥—ã–≤–∞—è –æ–¥–Ω–∏–º –≥–ª–∞–∑–æ–º. –°–ø–∞—Å–∏–±–æ –∑–∞ –ª—É—Ä–∫!",
                f"@{user} —Ç–µ–ª–µ–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤ –∫—É—Å—Ç—ã. –≠—Ç–∏ —Å–∞–º—ã–µ‚Ä¶ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ.",
                f"@{user} —É–∫—É—Ç—ã–≤–∞–µ—Ç—Å—è –≤ –ø–ª–µ–¥-–∫–æ–∫–æ–Ω –∏ —Ç–∏—Ö–æ –Ω–∞–±–ª—é–¥–∞–µ—Ç –∑–∞ —Å—Ç—Ä–∏–º–æ–º –æ—Ç—Ç—É–¥–∞.",
                f"@{user} —É—Ö–æ–¥–∏—Ç —á–∏–Ω–∏—Ç—å –∫–∞–∫—É—é-—Ç–æ –æ—á–µ–Ω—å –≤–∞–∂–Ω—É—é —à—Ç—É–∫—É, –Ω–æ —Å–ª—ã—à–∏—Ç —Å—Ç—Ä–∏–º —Ñ–æ–Ω–æ–º.",
                f"@{user} —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –≥–∏—Ñ–∫–æ–π ¬´loading‚Ä¶¬ª –∏ –∏—Å—á–µ–∑–∞–µ—Ç –≤ –ª—É—Ä–∫–µ.",
                f"@{user} –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –∫–∞–º–µ–Ω—å. –ù–æ —Ç–∞–∫–æ–π‚Ä¶ –Ω–∞–±–ª—é–¥–∞—é—â–∏–π –∫–∞–º–µ–Ω—å.",
                f"@{user} –∑–∞–±–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ —à–∫–∞—Ñ. –û—Ç—Ç—É–¥–∞ –∏ –ª—É—Ä–∫–∞–µ—Ç. –°—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏.",
                f"@{user} –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç —Ä–µ–∂–∏–º AFK + –Ω–∞–±–ª—é–¥–µ–Ω–∏–µ. –°–ø–∞—Å–∏–±–æ –∑–∞ –ª—É—Ä–∫!",
                f"@{user} –Ω—ã—Ä—è–µ—Ç –ø–æ–¥ –∫—Ä–æ–≤–∞—Ç—å, –≥–¥–µ –∂–∏–≤—ë—Ç –º–æ–Ω—Å—Ç—Ä-–ª—É—Ä–∫–µ—Ä. –¢–µ–ø–µ—Ä—å –æ–Ω–∏ –ª—É—Ä–∫–∞—é—Ç –≤–¥–≤–æ—ë–º.",
                f"@{user} —Ç–∏—Ö–æ –ø–∞–¥–∞–µ—Ç —Å –∫—Ä–µ—Å–ª–∞ –∏ —Ä–µ—à–∞–µ—Ç –æ—Å—Ç–∞—Ç—å—Å—è –≤–Ω–∏–∑—É –ª—É—Ä–∫–∞—Ç—å.",
                f"@{user} –∑–∞–±–∏—Ä–∞–µ—Ç—Å—è –Ω–∞ –ª—é—Å—Ç—Ä—É –∏ –≤–∏—Å–∏—Ç —Ç–∞–º, –Ω–∞–±–ª—é–¥–∞—è –∑–∞ —á–∞—Ç–æ–º –∫–∞–∫ –ª–µ—Ç—É—á–∞—è –º—ã—à—å.",
                f"–í–Ω–∏–º–∞–Ω–∏–µ, —á–∞—Ç! –í–∞–∂–Ω–æ–µ –æ–±—ä—è–≤–ª–µ–Ω–∏–µ! –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é @{user} –Ω—É–∂–Ω–æ –ø–æ–π—Ç–∏ –ø–æ–∫–∞–∫–∞—Ç—å! (–õ–∞–¥–Ω–æ, –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ, —á—Ç–æ –±—ã –í—ã –Ω–µ –¥–µ–ª–∞–ª–∏, —É–¥–∞—á–∫–∏ —Å –¥–µ–ª–∞–º–∏! <3)"
            ]
            return random.choice(variants)

        if previous_state and not state:
            await self._state_manager.set_state(
                channel=streamer.login_name,
                user=user.lower(),
                command=self.command_name,
                value=None,
            )
            unlurk_variants = [
                f"@{user} –≤—ã–ø–ª—ã–≤–∞–µ—Ç –∏–∑ –ª—É—Ä–∫–∞. –° –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ–º!",
                f"@{user} –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∏–∑ —Ç–µ–Ω–∏ –∏ —Å–Ω–æ–≤–∞ —Å –Ω–∞–º–∏!",
                f"@{user} –≤—ã–±–µ–≥–∞–µ—Ç –æ–±—Ä–∞—Ç–Ω–æ –≤ —á–∞—Ç, –∑–∞–ø—ã—Ö–∞–≤—à–∏—Å—å. –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!",
                f"@{user} —Å–Ω–∏–º–∞–µ—Ç –ø–ª–∞—â-–Ω–µ–≤–∏–¥–∏–º–∫—É. –ü—Ä–∏–≤–µ—Ç –æ–±—Ä–∞—Ç–Ω–æ!",
                f"@{user} —Å–Ω–æ–≤–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç—Å—è –≤ —á–∞—Ç–µ!",
                f"@{user} –≥—Ä–æ–º–∫–æ –∑–∞—è–≤–ª—è–µ—Ç: ¬´–Ø –≤–µ—Ä–Ω—É–ª—Å—è!¬ª",
                f"@{user} –≤—ã–ø–∞–¥–∞–µ—Ç –∏–∑ –∫–∞—Ä–º–∞–Ω–∞ —Å—Ç—Ä–∏–º–µ—Ä–∞ –∏ –ø–µ—Ä–µ—Å—Ç–∞—ë—Ç –ª—É—Ä–∫–∞—Ç—å.",
                f"@{user} –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è —Å –ø–µ—á–µ–Ω—å–µ–º. –°–∞–º –ª—É—Ä–∫–∞–ª ‚Äî –∏ –Ω–∞–º –ø—Ä–∏–Ω—ë—Å!",
                f"@{user} –≤–æ—Å—Å—Ç–∞—ë—Ç –∏–∑ –≥–ª—É–±–∏–Ω –ª—É—Ä–∫–∞, –∫–∞–∫ –¥—Ä–µ–≤–Ω–∏–π –¥—É—Ö.",
                f"@{user} —Å–Ω–æ–≤–∞ –∞–∫—Ç–∏–≤–µ–Ω –≤ —á–∞—Ç–µ ‚Äî –ª—É—Ä–∫ –æ–∫–æ–Ω—á–µ–Ω!",
                f"@{user} –≤—ã–ª–µ–∑–∞–µ—Ç –∏–∑ –∫—É—Å—Ç–æ–≤ –∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ—Ç—Å—è –∫ –±–æ–ª—Ç–æ–≤–Ω–µ.",
                f"@{user} –≤–Ω–µ–∑–∞–ø–Ω–æ —Å–≤–∞–ª–∏–≤–∞–µ—Ç—Å—è —Å –ª—é—Å—Ç—Ä—ã, –ø—Ä—è–º–æ –Ω–∞ —Å—Ç–æ–ª –ø–µ—Ä–µ–¥ —Å—Ç—Ä–∏–º–µ—Ä–æ–º!"
            ]
            return random.choice(unlurk_variants)
