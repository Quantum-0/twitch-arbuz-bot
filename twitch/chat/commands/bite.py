import random

from database.models import TwitchUserSettings, User
from twitch.chat.base.target_command import SimpleTargetCommand
from twitch.utils import delay_to_seconds, join_targets


class BiteCommand(SimpleTargetCommand):
    command_name = "bite"
    command_aliases = ["bite", "ÐºÑƒÑÑŒ", "ÐºÑƒÑÑŒÐ±", "ÑƒÐºÑƒÑÐ¸Ñ‚ÑŒ", "ÐºÑƒÑÐ½ÑƒÑ‚ÑŒ"]
    command_description = "Ð£ÐºÑƒÑÐ¸Ñ‚ÑŒ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ Ñ‡Ð°Ñ‚Ð°"

    need_target = True
    cooldown_timer = 45
    cooldown_count = 2

    def is_enabled(self, streamer_settings: TwitchUserSettings) -> bool:
        return streamer_settings.enable_bite

    async def _handle(
        self, streamer: User, user: str, message: str, targets: list[str]
    ) -> str:
        kind_of_bite = [
            "Ð·Ð»Ð¾Ð±Ð½Ñ‹Ð¹",
            "Ð¿Ñ€Ð¸ÑÑ‚Ð½Ñ‹Ð¹",
            "Ð¼ÑÐ³ÐºÐ¸Ð¹",
            "Ð½ÐµÐ¶Ð½Ñ‹Ð¹",
            "Ð°ÐºÐºÑƒÑ€Ð°Ñ‚Ð½Ñ‹Ð¹",
            "Ð°Ð³Ñ€ÐµÑÑÐ¸Ð²Ð½Ñ‹Ð¹",
            "ÐºÐ¾Ð²Ð°Ñ€Ð½Ñ‹Ð¹",
            "ÑˆÐ°Ð»Ð¾Ð²Ð»Ð¸Ð²Ñ‹Ð¹",
            "ÑÑ‚Ñ€Ð°ÑÑ‚Ð½Ñ‹Ð¹",
            "Ð¸Ð³Ñ€Ð¸Ð²Ñ‹Ð¹",
            "Ñ€Ð¾Ð±ÐºÐ¸Ð¹",
            "Ð»ÐµÐ½Ð¸Ð²Ñ‹Ð¹",
            "Ð¾Ð·Ð¾Ñ€Ð½Ð¾Ð¹",
            "Ð·Ð°Ð´ÑƒÐ¼Ñ‡Ð¸Ð²Ñ‹Ð¹",
            "ÑˆÑƒÑ‚Ð»Ð¸Ð²Ñ‹Ð¹",
            "Ð¿Ð¾Ð´Ð»Ñ‹Ð¹",
        ]
        bite_verb = [
            *["Ð´ÐµÐ»Ð°ÐµÑ‚"]*4,
            "ÑÐ¾Ð²ÐµÑ€ÑˆÐ°ÐµÑ‚",
            "ÑƒÑÑ‚Ñ€Ð°Ð¸Ð²Ð°ÐµÑ‚",
            "Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚",
        ]
        target_to_bite = [
            "Ð»ÐµÐ²Ð¾Ðµ ÑƒÑ…Ð¾",
            "Ð¿Ñ€Ð°Ð²Ð¾Ðµ ÑƒÑ…Ð¾",
            "Ð¿ÑÑ‚ÐºÑƒ",
            "Ñ…Ð²Ð¾ÑÑ‚",
            "Ð½Ð¾Ð³Ñƒ",
            "Ð¿ÑÑ€ÑÐ¸ÐºÐ¸",
            "Ð½Ð¾Ñ",
            "Ð¿Ð»ÐµÑ‡Ð¾",
            "Ð¶Ñ‘Ð¿ÐºÑƒ",
            "Ð¿Ð°Ð»ÐµÑ†",
            "Ð¶Ð¸Ð²Ð¾Ñ‚Ð¸Ðº",
            "Ð»Ð¾ÐºÐ¾Ñ‚ÑŒ",
            "ÐºÐ¾Ð»ÐµÐ½ÐºÑƒ",
            "Ð¿Ð°Ð»ÑŒÑ‡Ð¸Ðº",
            "Ð±Ð¾Ñ‡Ð¾Ðº",
            "ÑˆÐµÑŽ",
        ]
        target = join_targets(targets)
        # TODO: ÐºÑƒÑÐ°ÐµÑ‚, Ð´ÐµÐ»Ð°ÐµÑ‚ ÐºÑƒÑÑŒ, ÐºÑƒÑÑÐ²ÐºÐ°ÐµÑ‚, Ð¿Ð¾ÐºÑƒÑÑ‹Ð²Ð°ÐµÑ‚?
        return f"@{user} {random.choice(bite_verb)} {random.choice(kind_of_bite)} ÐºÑƒÑÑŒ {target} Ð·Ð° {random.choice(target_to_bite)}"

    async def _no_target_reply(self, user: str) -> str | None:
        return random.choice([
            *[f'Ð§Ñ‚Ð¾Ð±Ñ‹ ÑƒÐºÑƒÑÐ¸Ñ‚ÑŒ ÐºÐ¾Ð³Ð¾-Ñ‚Ð¾, Ð½ÑƒÐ¶Ð½Ð¾ ÑƒÐºÐ°Ð·Ð°Ñ‚ÑŒ Ñ†ÐµÐ»ÑŒ. ÐÐ°Ð¿Ñ€Ð¸Ð¼ÐµÑ€: "!ÐºÑƒÑÑŒ @{user}"']*4,
            f"@{user}, ÐºÑƒÑÑŒ Ð² Ð¿ÑƒÑÑ‚Ð¾Ñ‚Ñƒ â€” ÑÑ‚Ð¾, ÐºÐ¾Ð½ÐµÑ‡Ð½Ð¾, Ð¼Ð¸Ð»Ð¾, Ð½Ð¾ Ð»ÑƒÑ‡ÑˆÐµ ÑƒÐºÐ°Ð¶Ð¸ Ð¶ÐµÑ€Ñ‚Ð²Ñƒ!",
        ])

    async def _cooldown_reply(self, user: str, delay: int) -> str | None:
       return random.choice([
            f"@{user}, Ñ‚Ð²Ð¾Ð¸ Ð·ÑƒÐ±ÐºÐ¸ Ð½Ð°Ñ…Ð¾Ð´ÑÑ‚ÑÑ Ð² Ð¿ÐµÑ€ÐµÐ·Ð°Ñ€ÑÐ´ÐºÐµ! ÐŸÐ¾Ð´Ð¾Ð¶Ð´Ð¸ Ñ‡ÑƒÑ‚ÑŒ-Ñ‡ÑƒÑ‚ÑŒ, Ð¿Ñ€ÐµÐ¶Ð´Ðµ Ñ‡ÐµÐ¼ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒÑÑ ÐºÐ¾Ð¼Ð°Ð½Ð´Ð¾Ð¹ ÑÐ½Ð¾Ð²Ð°.",
            f"@{user}, Ñ‚Ð²Ð¾Ð¸ Ð·ÑƒÐ±ÐºÐ¸ ÑƒÑÑ‚Ð°Ð»Ð¸ ÐºÑƒÑÐ°Ñ‚ÑŒÑÑ, Ð¿Ð¾Ð´Ð¾Ð¶Ð´Ð¸ {delay_to_seconds(delay)}, Ð¿Ñ€ÐµÐ¶Ð´Ðµ Ñ‡ÐµÐ¼ Ð´ÐµÐ»Ð°Ñ‚ÑŒ Ð½Ð¾Ð²Ñ‹Ð¹ ÐºÑƒÑÑŒ!",
            f"@{user}, Ñ‚Ð²Ð¾Ð¸ Ð·ÑƒÐ±ÐºÐ¸ Ð¾Ñ‚Ð´Ñ‹Ñ…Ð°ÑŽÑ‚! ÐŸÐ¾Ð´Ð¾Ð¶Ð´Ð¸ Ð½ÐµÐ¼Ð½Ð¾Ð³Ð¾ Ð¿ÐµÑ€ÐµÐ´ Ð½Ð¾Ð²Ñ‹Ð¼ ÑƒÐºÑƒÑÐ¾Ð¼.",
            f"Ð—ÑƒÐ±ÐºÐ¸ @{user} Ð·Ð°Ñ€ÑÐ¶Ð°ÑŽÑ‚ÑÑâ€¦ Ð–Ð´Ð¸ {delay_to_seconds(delay)}!",
            f"@{user}, Ñ‚Ð²Ð¾Ð¹ Ð¿Ð¾ÑÐ»ÐµÐ´Ð½Ð¸Ð¹ ÐºÑƒÑÑŒ Ð±Ñ‹Ð» ÑÐ»Ð¸ÑˆÐºÐ¾Ð¼ ÑÐ¸Ð»Ñ‘Ð½ Ð¸ ÐºÐ¾Ð²Ð°Ñ€ÐµÐ½, Ð·ÑƒÐ±ÐºÐ°Ð¼ Ñ‚Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ Ð¿ÐµÑ€ÐµÐ·Ð°Ñ€ÑÐ´ÐºÐ°.",
            f"@{user}, ÐµÑ‰Ñ‘ Ñ‡ÑƒÑ‚ÑŒ-Ñ‡ÑƒÑ‚ÑŒ Ñ‚ÐµÑ€Ð¿ÐµÐ½Ð¸Ñ â€” Ð¸ Ð¼Ð¾Ð¶Ð½Ð¾ Ð±ÑƒÐ´ÐµÑ‚ ÑÐ½Ð¾Ð²Ð° ÐºÑƒÑÐ°Ñ‚ÑŒÑÑ!",
        ])

    async def _self_call_reply(self, user: str) -> str | None:
        return random.choice([
            f"@{user} ÐºÑƒÑÐ°ÐµÑ‚ ÑÐ°Ð¼ ÑÐµÐ±Ñ Ð¾.Ðž",
            f"@{user} ÑÐ¾Ð²ÐµÑ€ÑˆÐ°ÐµÑ‚ Ð¡ÐÐœÐžÐšÐ£Ð¡Ð¬!",

            f"@{user} Ñ€ÐµÑˆÐ°ÐµÑ‚ Ð¿Ñ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð²ÐºÑƒÑ ÑÐ¾Ð±ÑÑ‚Ð²ÐµÐ½Ð½Ñ‹Ñ… Ð¿Ð°Ð»ÑŒÑ†ÐµÐ² ðŸ¤”",
            f"Ð¡Ð°Ð¼Ð¾ÐºÑƒÑÑŒ?! @{user}, Ñ‚Ñ‹ Ñ‡ÐµÐ³Ð¾? Ð¢ÐµÐ±Ñ Ð´Ð°Ð²Ð½Ð¾ Ð½Ðµ ÐºÐ¾Ñ€Ð¼Ð¸Ð»Ð¸? :Ñ",
            f"@{user} Ð² ÑÑ€Ð¾ÑÑ‚Ð¸ â€” ÐºÑƒÑÐ°ÐµÑ‚ ÑÐµÐ±Ñ Ð·Ð° ÑƒÑ…Ð¾! ÐšÐ°Ðº? ÐžÑÑ‚Ð°Ñ‘Ñ‚ÑÑ Ð·Ð°Ð³Ð°Ð´ÐºÐ¾Ð¹..",
            # f"Ð­Ñ‚Ð¾ Ð±Ñ‹Ð»Ð¾ Ð±Ð¾Ð»ÑŒÐ½Ð¾, Ð½Ð¾ Ð²ÐµÑÐµÐ»Ð¾: @{user} ÐºÑƒÑÐ°ÐµÑ‚ ÑÐ°Ð¼Ð¾Ð³Ð¾ ÑÐµÐ±Ñ.",
            f"Ð¡Ð°Ð¼Ð¾ÐºÑƒÑÑŒ Ð°ÐºÑ‚Ð¸Ð²Ð¸Ñ€Ð¾Ð²Ð°Ð½. @{user} ÑƒÐ´Ð¸Ð²Ð»Ñ‘Ð½, Ð½Ð¾ Ð´Ð¾Ð²Ð¾Ð»ÐµÐ½.",
        ])

    async def _bot_call_reply(self, user: str, target: str) -> str | None:
        return random.choice([
            f"{target} Ð¿Ñ€Ð¾ÑÑ‚Ð¸Ñ‚Ðµ Ð·Ð° Ð±ÐµÑÐ¿Ð¾ÐºÐ¾Ð¹ÑÑ‚Ð²Ð¾, ÐºÐ¾Ð»Ð»ÐµÐ³Ð°-Ð±Ð¾Ñ‚, Ð½Ð¾ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ @{user} Ð´ÐµÐ»Ð°ÐµÑ‚ Ð²Ð°Ð¼ ÐºÑƒÑÑŒÐ±",
        ])

    async def _this_bot_call_reply(self, user: str) -> str | None:
        return random.choice([
            f"@{user}, Ð° Ð¼ÐµÐ½Ñ Ñ‚Ð¾ Ð·Ð° Ñ‡Ñ‚Ð¾?!",
            f"ÐœÐµÐ½Ñ ÐºÑƒÑÐ°Ñ‚ÑŒ Ð½ÐµÐ»ÑŒÐ·Ñ, ÐºÑƒÑÐ°Ð¹ ÐºÐ¾Ð³Ð¾-Ð½Ð¸Ð±ÑƒÐ´ÑŒ Ð´Ñ€ÑƒÐ³Ð¾Ð³Ð¾!",
            f"ÐÑƒ ÐºÐ°Ð¿ÐµÑ†, ÑƒÐ¶Ðµ Ð½Ð° Ð±Ð¾Ñ‚Ð¾Ð² ÑÐ²Ð¾Ð¸Ð¼Ð¸ Ð·ÑƒÐ±Ð°Ð¼Ð¸ Ð½Ð°Ð¿Ð°Ð´Ð°ÑŽÑ‚..",
            f"@{user}, Ñ‰Ð°Ñ ÐºÐ°Ðº ÑÐ°Ð¼ Ñ‚ÐµÐ±Ñ ÑƒÐºÑƒÑˆÑƒ >:c Ð‘Ð°Ð½Ñ…Ð°Ð¼ÐµÑ€Ð¾Ð¼!!!",
        ])
